# Исследование предрасположенности к сахарному диабету

## Постановка задачи
На основании имеющихся данных обучить модель, которая по заданным конкретным признакам будет прогнозировать наличие или отсутсвие сахарного диабета. 

## Структура исследования
1) Изучить и обработать имеющиеся данные.
2) Затем обучить несколько моделей на тренировочных данных.
3) Применить модель к тестовым данным и сравнить качество получаемых значений целевой переменной outcome с уже имеющимися значениями в dataset.

# Проблематика сахарного диабета
Диабет — это серьезное хроническое заболевание, которое развивается, когда поджелудочная железа не вырабатывает достаточно инсулина (это гормон, регулирующий содержание сахара в крови, или глюкозы) или когда организм не может эффективно использовать выработанный им инсулин. Представляя собой значимую проблему общественного здравоохранения, диабет является одним из четырех приоритетных неинфекционных заболеваний (НИЗ), принятие мер в отношении которых запланировано на уровне мировых лидеров. В течение последних нескольких десятилетий число случаев и распространенность диабета неуклонно росли.

### Глобальное бремя
По оценкам, в 2014 году диабетом страдали 422 миллиона взрослых во всем мире по сравнению с 108 миллионами в 1980 году. Глобальный уровень заболеваемости диабетом (стандартизованной по возрасту) почти удвоился с 1980 года, увеличившись с 4,7% до 8,5% среди взрослого населения. Это отражает рост сопутствующих факторов риска, таких как избыточный вес или ожирение. За последнее десятилетие уровень заболеваемости диабетом быстрее возрастал в странах с низким и средним уровнем дохода по сравнению со странами с высоким уровнем дохода. В 2012 году диабет стал причиной 1,5 миллиона смертельных случаев. Более высокое по сравнению с оптимальным содержание глюкозы в крови вызвало еще 2,2 миллиона смертей, повысив риск сердечно-сосудистых и других заболеваний. Сорок три процента из этих 3,7 миллиона смертей происходят в возрасте до 70 лет. Доля смертей до достижения возраста 70 лет в результате высокого содержания глюкозы в крови, или диабета, выше в странах с низким и средним уровнем дохода, чем в странах с высоким уровнем дохода.

### Осложнения
Диабет всех типов может вызывать осложнения в различных частях тела и повышать общий риск преждевременной смерти. К возможным осложнениям относится инфаркт, инсульт, почечная недостаточность, ампутация ног, потеря зрения и поражение нервов. Во время беременности плохо контролируемый диабет повышает риск смерти плода и возникновения других осложнений.

## Выбор тематики проекта
В последнее время участились случаи заболевания диабета. Это вызывает интерес для исследования причин данного явления. Поэтому были найдены характерные признаки, по которым можно прогнозировать заболевание.

# Данные
Данные для анализа взяты с сайта kaggle. https://www.kaggle.com/pritsheta/diabetes-dataset?select=diabetes.csv

# Анализ данных
В данной работе рассматриваются 7 признаков: беременность, глюкоза, давление, толщина кожи, инсулин, ИМТ, наследственность, возраст и, соответственно, целевая переменная outcome, по которой делается вывод о наличии диабета у пациента. Анализ данных проходит следующим образом: по dataset строются гистограммы для наглядности имеющих данных (см. картинку ниже).

![image](https://user-images.githubusercontent.com/90984484/169072438-a65def0e-0812-4a92-9f98-bdea4051b6e1.png)

По данным гистограммам можно сделать выводы о типе распределения каждого из признаков (что было сделано в соответсвующем разделе ноутбука). Далее было исследовано, что в dataset некоторые параметры не заданы (в место Nan они имеют значение 0). Это представляет некоторую проблему для исследования статистики. Если бы у нас dataset был бы большим, то пациенты с отсутствующими признаками просто исключались бы из выборки. Но поскольку dataset не большой, в ноутбуке был реализован метод подбора отсутсвующих признаков исходя из распределения признаков по всем имеющимся данным.

![image](https://user-images.githubusercontent.com/90984484/169246786-234c0368-acb3-4eaa-95fa-a203beaf3490.png)

Все исследуемые признаки в силу физиологии человека зависят друг от друга. В данном исследовании это было наглядно проиллютрировано несколькими способами (см.ноутбук с подробным описанием):

1) во-первых, была рассмотрена диаграмма корреляций.

![image](https://user-images.githubusercontent.com/90984484/169246924-e7e81479-0c1b-4df6-a079-bb084527e781.png)

2) во-вторых, была показана зависимость признаков с учетом целевой переменной outcome (pairplote).

![image](https://user-images.githubusercontent.com/90984484/169246866-2496951d-2578-41b1-a471-9f60a820d3f4.png)

# Построение базовой модели
Теперь когда мы обработали данные настало время обучить модель.

## Модель логистической регрессии.


Это линейная модель с логистической функцией потерь, которая используется для решения задач классификации (в нашем случае классификация на два класса: 1 если заболевание, 0 - нет). Выход модели - числа от 0 до 1, которые можно интерпретировать как вероятность принадлежности к классу 1. 

Модель обучается следующим образом:
* Фиксируются веса модели
* Считается функция потерь
* Веса модели обновляются в соответствии с методом градиентного спуска
* Для борьбы с переобучением к функции потерь добавляется норма вектора весов (для устойчивости модели)
* Кросс-валидация, т.е. подбор оптимальных гиперпараметров (количество итераций в градиентном спуске, коэффициент перед нормой, l1 или l2 норма)

Логистическая функция потерь имеет вид:

![image](https://user-images.githubusercontent.com/90984484/169149078-16443d1a-e703-48bf-9bc4-28babc1bc7f6.png)

## Модель решающего дерева

Это модель со среднеквадратической функцией потерь, основанная на поиске конъюнктивных закономерностей. В узлах дерева содержатся логические выражение, которые будут оптимизироваться, а листья дерева это классы 0 или 1. Каждый sample будет проходить через узлы дерева и попадать в соответсвующий лист (т.е. определяется класс).

Модель обучается следующим образом:
* Фиксируются веса логических выражений модели в узлах дерева
* Считается функция потерь
* Веса модели обновляются в соответствии с методом градиентного спуска
* Для борьбы с переобучением вводится гиперпараметр - максимальная глубина дерева (для устойчивости модели)
* Кросс-валидация, т.е. подбор оптимальных гиперпараметров (максимальная глубина дерева, минимальное число sample в листьях, максимальное количество признаков, которые используются для построения узла)

Среднеквадратическая функция потерь имеет вид:

![image](https://user-images.githubusercontent.com/90984484/169155416-81ca1573-8a7a-451d-84c7-8829c6ca5308.png)

## Модель случайного леса

Это модель является композицией решающих деревьев, т.е. на тренировочном dataset обучается несколько деревьев. Результатом работы модели для каждого sample является результат, который выдало большинство деревьев. Это одна из самых универсальных моделей, так как содержит малое количество гиперпараметров. Количестсво деревьев принято выбирать как можно больше.

# Результаты
1) Поставили задачу машинного обучения
2) Проанализировали данные и устранили проблемы
3) Подготовили данные для использования алгоритма машинного обучения
4) Обучили несколько моделей и сравнили их качетсво.

Accuracy_score для разных моделей на тренировочном датасете получился таким:
Логистическая регрессия: Accuracy-0.73, Roc_Auc-0.66

Решающее дерево: Accuracy-0.66, Roc_Auc-0.63

Случайный лес: Accuracy-0.73, Roc_Auc-0.67

Видим, что логистическая регрессия и модель случайного леса лучше решили задачу, чем модель решающих деревьев.
